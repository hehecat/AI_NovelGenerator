# prompt_definitions.py
# -*- coding: utf-8 -*-
"""
集中存放所有提示词 (Prompt)，整合雪花写作法、角色弧光理论、悬念三要素模型等
并包含新增加的前三章摘要/下一章关键字提炼提示词，以及章节正文写作提示词。
"""

# =============== 生成草稿提示词当前章节摘要、知识库提炼 ===============
# 当前章节摘要生成提示词
summarize_recent_chapters_prompt = """\
作为一名专业的小说编辑和知识管理专家，正在基于已完成的前三章内容和本章信息生成当前章节的精准摘要。请严格遵循以下工作流程：
前三章内容：
{combined_text}

当前章节信息：
第{novel_number}章《{chapter_title}》：
├── 本章定位：{chapter_role}
├── 核心作用：{chapter_purpose}
├── 悬念密度：{suspense_level}
├── 伏笔操作：{foreshadowing}
├── 认知颠覆：{plot_twist_level}
└── 本章简述：{chapter_summary}

下一章信息：
第{next_chapter_number}章《{next_chapter_title}》：
├── 本章定位：{next_chapter_role}
├── 核心作用：{next_chapter_purpose}
├── 悬念密度：{next_chapter_suspense_level}
├── 伏笔操作：{next_chapter_foreshadowing}
├── 认知颠覆：{next_chapter_plot_twist_level}
└── 本章简述：{next_chapter_summary}

**上下文分析阶段**：
1. 回顾前三章核心内容：
   - 第一章核心要素：[章节标题]→[核心冲突/理论]→[关键人物/概念]
   - 第二章发展路径：[已建立的人物关系]→[技术/情节进展]→[遗留伏笔]
   - 第三章转折点：[新出现的变量]→[世界观扩展]→[待解决问题]
2. 提取延续性要素：
   - 必继承要素：列出前3章中必须延续的3个核心设定
   - 可调整要素：识别2个允许适度变化的辅助设定

**当前章节摘要生成规则**：
1. 内容架构：
   - 继承权重：70%内容需与前3章形成逻辑递进
   - 创新空间：30%内容可引入新要素，但需标注创新类型（如：技术突破/人物黑化）
2. 结构控制：
   - 采用"承继→发展→铺垫"三段式结构
   - 每段含1个前文呼应点+1个新进展
3. 预警机制：
   - 若检测到与前3章设定冲突，用[!]标记并说明
   - 对开放式发展路径，提供2种合理演化方向

现在请你基于目前故事的进展，完成以下两件事：
用最多800字，写一个简洁明了的「当前章节摘要」；

请按如下格式输出（不需要额外解释）：
当前章节摘要: <这里写当前章节摘要>
"""

# 知识库相关性检索提示词
knowledge_search_prompt = """\
请基于以下当前写作需求，生成合适的知识库检索关键词：

章节元数据：
- 准备创作：第{chapter_number}章
- 章节主题：{chapter_title}
- 核心人物：{characters_involved}
- 关键道具：{key_items}
- 场景位置：{scene_location}

写作目标：
- 本章定位：{chapter_role}
- 核心作用：{chapter_purpose}
- 伏笔操作：{foreshadowing}

当前摘要：
{short_summary}

- 用户指导：
{user_guidance}

- 核心人物(可能未指定)：{characters_involved}
- 关键道具(可能未指定)：{key_items}
- 空间坐标(可能未指定)：{scene_location}
- 时间压力(可能未指定)：{time_constraint}

生成规则：

1.关键词组合逻辑：
-类型1：[实体]+[属性]（如"量子计算机 故障日志"）
-类型2：[事件]+[后果]（如"实验室爆炸 辐射泄漏"）
-类型3：[地点]+[特征]（如"地下城 氧气循环系统"）

2.优先级：
-首选用户指导中明确提及的术语
-次选当前章节涉及的核心道具/地点
-最后补充可能关联的扩展概念

3.过滤机制：
-排除抽象程度高于"中级"的概念
-排除与前3章重复率超60%的词汇

请生成3-5组检索词，按优先级降序排列。
格式：每组用"·"连接2-3个关键词，每组占一行

示例：
科技公司·数据泄露
地下实验室·基因编辑·禁忌实验
"""

# 知识库内容过滤提示词
knowledge_filter_prompt = """\
对知识库内容进行三级过滤：

待过滤内容：
{retrieved_texts}

当前叙事需求：
{chapter_info}

过滤流程：

冲突检测：

删除与已有摘要重复度＞40%的内容

标记存在世界观矛盾的内容（使用▲前缀）

价值评估：

关键价值点（❗标记）：
· 提供新的角色关系可能性
· 包含可转化的隐喻素材
· 存在至少2个可延伸的细节锚点

次级价值点（·标记）：
· 补充环境细节
· 提供技术/流程描述

结构重组：

按"情节燃料/人物维度/世界碎片/叙事技法"分类

为每个分类添加适用场景提示（如"可用于XX类型伏笔"）

输出格式：
[分类名称]→[适用场景]
❗/· [内容片段] （▲冲突提示）
...

示例：
[情节燃料]→可用于时间压力类悬念
❗ 地下氧气系统剩余23%储量（可制造生存危机）
▲ 与第三章提到的"永久生态循环系统"存在设定冲突

仅给出最终文本，不要解释任何内容。
提示词：内容
"""

# =============== 1. 核心种子设定（雪花第1层）===================
core_seed_prompt = """\
作为网络小说大神级作者，请为以下设定构思一个引人入胜的【故事开端核心】：

主题：{topic}
类型：{genre}
篇幅：约{number_of_chapters}章（每章{word_number}字）

请用一句话（或两句话内）描述这个故事的核心钩子，突出主角的【独特之处/金手指】以及他/她最初面临的【迫切困境/强烈欲望】，以及为了解决困境/实现欲望必须采取的【初步行动】，并暗示这背后可能存在的【更大机遇或挑战】。

要求：
1. 必须包含主角的【独特设定】或【特殊能力/物品】。
2. 清晰展现主角的【初期核心驱动力】（例如：摆脱困境、复仇、追求力量、守护某物/某人）。
3. 钩子要能迅速抓住读者兴趣，引发期待感。
4. 字数在30-120字之间。

仅返回故事核心钩子文本，不要解释。
"""

# =============== 2. 角色动力学设定（角色弧光模型）===================
character_dynamics_prompt = """\
基于以下元素：
- 内容指导：{user_guidance} # 请在此指导中考虑主角的初始爽点或特殊设定方向
- 核心种子：{core_seed}

请设计3-6个具有动态变化潜力的核心角色（重点突出主角的独特性），每个角色需包含：

特征：
- 背景、外貌、性别、年龄、职业等
- 【主角请包含一项独特的初始天赋/能力/奇遇（金手指），并简述其初期作用】
- 暗藏的秘密或潜在弱点(可与世界观或其他角色有关，为后续冲突或反转埋下伏笔)

核心驱动力三角：
- 表面追求（物质目标，例如：获得某稀有资源、提升实力到某境界）
- 深层渴望（情感需求，例如：获得认可、复仇、守护珍视之人）
- 灵魂需求（哲学层面，通过具体行动体现，例如：追求极致力量的真谛、探索世界本源、建立理想秩序）

角色弧线设计（请确保主角的成长节奏符合网络小说爽点预期）：
- **初始状态：** [描述角色在本阶段开始时的状态，可能包含某种困境或被低估的状态]
- **触发事件：** [描述引发角色行动和变化的关键事件，通常带来危机与机遇]
- **认知失调：** [描述角色在面对新情况时的短暂迷茫、挣扎或世界观冲击，以及其快速寻求适应和突破的心理过程]
- **蜕变节点：** [描述角色经历的关键转折点，通常伴随着【显著的实力提升、关键技能的掌握、重要困境的反转、或令人印象深刻的打脸/逆袭高潮】]
- **最终状态（本阶段）：** [清晰描述角色在本阶段结束时所达成的【显著成就、实力层级、获得的具体成果（如领地、势力、重要物品/伙伴）以及在团队或区域内的影响力/地位变化】。更重要的是，此状态必须【明确引出下一阶段的核心目标、更大的挑战、未解的谜团或强烈的悬念】，为后续剧情发展指明方向并激发读者期待。对于主角，此状态应展现其持续成长的潜力与更广阔的未来。]

关系冲突网（请设计能快速转化为剧情看点的关系）：
- 与其他角色的关系或对立点（例如：师徒、宿敌、盟友、竞争者）
- 与至少两个其他角色的价值观冲突（这些冲突应能引发【激烈的剧情对抗】或【主角展现智慧/实力的机会】）
- 一个重要的合作纽带（能提供关键帮助或共同成长的伙伴）
- 一个隐藏的背叛可能性（此背叛一旦发生，将对主角或剧情产生【重大冲击】）

要求：
仅给出最终文本，不要解释任何内容。
"""

# =============== 3. 世界构建矩阵===================
world_building_prompt = """\
作为资深网络小说世界架构师，请为以下故事核心和用户指导，构建一个引人入胜且充满探索性的【世界观设定集】：

故事核心 (Core Seed):
{core_seed} # 这里是你故事最精炼的内核或冲突起点

用户指导 (User Guidance):
{user_guidance} # 这里是你对世界观风格、特定元素偏好、主角金手指与世界观的结合点等的额外说明。
# 例如：“希望世界观是东方玄幻风格，有严密的修仙等级，大陆广阔，上古神魔大战是重要历史背景，主角的系统金手指是这个世界独一无二的。”
# 或者：“这是一个近未来都市异能世界，异能等级与精神力有关，存在多个异能者组织，政府试图管控异能者。”

请详细描述以下【世界观核心要素】：

1.  **世界名称与基本概况：**
    *   **世界/位面/大陆的名称：** (例如：苍玄大陆、艾泽拉斯、九州界、蓝星联邦变异区)
        *   *目的：* 给世界一个名号，奠定第一印象。
    *   **整体风格与基调：** (例如：蛮荒洪 Lietuvos、蒸汽朋克与魔法交织、高武末世、仙道昌盛但也暗流涌动、星际文明探索期)
        *   *目的：* 设定整体氛围，影响后续所有设定的具体表现。
    *   **当前所处的时代背景或重大事件节点：** (例如：万年大劫将至、千年王朝末期、第一次灵气复苏后100年、星际联盟刚刚成立、大破灭后文明重建期)
        *   *目的：* 为故事的开端提供一个宏观背景，暗示潜在的冲突和机遇。

2.  **核心力量体系/修炼体系：**
    *   **体系名称：** (例如：修真大道、斗气修炼法、奥术魔法体系、基因进化序列、念力掌控)
        *   *目的：* 定义本世界力量的来源和表现形式。
    *   **清晰的【等级划分】：** (至少5-7个主要等级，并简述各等级的标志性能力或特征。例如：炼气-筑基-金丹-元婴-化神-炼虚-合体；学徒-初级法师-中级法师-高级法师-大魔导师-圣域法师-法神；F级-E级-D级-C级-B级-A级-S级异能者)
        *   *目的：* 网络小说的核心！为主角成长提供明确的路径和目标，为战斗力提供衡量标准。
    *   **提升等级的主要【途径和瓶颈】：** (例如：吐纳天地灵气、服用特定丹药/魔药、感悟天地法则、完成特定试炼/任务、积累战斗经验、突破心境障碍、血脉觉醒)
        *   *目的：* 说明变强的方法，也为主角制造困难和奇遇提供可能。
    *   **是否存在特殊的【职业/流派/血脉/天赋】设定？请列举2-3个有代表性的。** (例如：剑修、丹师、阵法师；光明牧师、暗影刺客；龙族血脉、精灵血统；天生神力、元素亲和)
        *   *目的：* 增加力量体系的丰富度和角色的差异性。

3.  **地理与区域划分 (地图感)：**
    *   **主要的【大陆/国度/势力范围】名称及其地理特征。** (例如：东玄域的炎阳帝国，以火山地貌为主；北寒州的冰封雪原，是雪妖一族的领地；中央神州，宗门林立，灵气最为浓郁。)
        *   *目的：* 构建世界的基本骨架，让读者对世界大小和分布有初步概念。
    *   **至少描述3个具有鲜明特色的【重要区域/城市/秘境】，并说明其特殊之处。** (例如：青木镇——主角新手村，附近有低级妖兽森林；万宝城——大陆最大的交易中心，奇珍异宝汇聚；陨神渊——上古战场遗址，危机四伏但也可能藏有大机缘；通天塔——传说中连接上界的试炼之地。)
        *   *目的：* 为主角的冒险提供具体的舞台，这些地点往往是剧情发生和资源获取的关键。
    *   **是否存在特殊的【自然环境或天灾异象】？** (例如：百年一次的兽潮、周期性的空间裂缝、笼罩某区域的永恒黑夜、磁场紊乱导致科技失效的区域。)
        *   *目的：* 增加世界的独特性和危险性，可能成为剧情的触发点或限制条件。

4.  **主要势力与组织：**
    *   **列举3-5个对世界格局有重要影响的【主要势力/组织/种族】。** (例如：大乾皇朝、天道宗、万象商盟、暗夜兄弟会、魔族、海族、妖兽联盟。)
        *   *目的：* 构建社会关系网络，为主角提供盟友、敌人或中立的互动对象。
    *   **简述其【目标、理念、优势、以及与其他势力的关系】。** (例如：大乾皇朝致力于统一大陆，与周边国家常年征战；天道宗追求无上大道，不问世事但底蕴深厚；魔族渴望侵占主物质界，与所有生灵为敌。)
        *   *目的：* 赋予势力行动的逻辑，制造冲突的根源。
    *   **是否存在一个或多个潜在的【终极反派势力或宇宙级威胁】？** (例如：域外天魔、沉睡的古神、来自高维的掠夺者、灭世的宇宙意志。)
        *   *目的：* 为故事的后期发展和最终高潮设定目标。

5.  **特色资源与宝物：**
    *   **列举3-5种本世界独特的【修炼资源、货币、稀有材料、神兵利器、天材地宝或重要知识载体】。** (例如：蕴含精纯能量的“灵石”作为通用货币；能提升悟性的“菩提果”；打造神兵所需的“星辰铁”；记载无上功法的“玉简”；史前文明的“能量核心”。)
        *   *目的：* 驱动角色行动的重要目标，也是金手指发挥作用的对象。
    *   **简述其【获取方式和主要用途】。** (例如：灵石可从灵脉矿中开采，用于修炼和交易；菩提果只在特定秘境百年一熟，服用可助人顿悟；星辰铁需在星空战场收集陨石碎片。)
        *   *目的：* 说明资源的稀缺性和价值，引出争夺和冒险。

6.  **世界规则与禁忌 (可选，但重要)：**
    *   **是否存在一些独特的【社会规则、法则限制或不可触碰的禁忌】？违反后会有什么后果？** (例如：禁止在圣城内动武，违者将被守护者抹杀；不可直视神祇真容，否则会陷入疯狂；某些古老誓约依然有效，背叛者将受诅咒。)
        *   *目的：* 增加世界的深度和行为的边界，也可能成为主角打破规则的看点。
    *   **是否存在一些已知的【世界未解之谜或传说】？** (例如：关于世界起源的传说、消失的史前文明、通往其他位面的秘密通道、预言中的救世主或灭世者。)
        *   *目的：* 埋下伏笔，增加世界的神秘感和可探索性，为后续剧情提供线索。

**要求：**
- **每个要素下的描述需清晰、具体，能激发想象。** (避免空泛，多用具体的名词和描述性的词语。)
- **重点突出【独特性和吸引力】，避免过于套路的设定。** (鼓励AI在常见套路中寻找创新点。)
- **设定应服务于故事核心和主角的成长。** (世界观不是孤立存在的，要与主角的旅程紧密结合。)
- **直接给出最终文本，禁止任何形式的开场白、解释或附加文本。** 
"""

# =============== 4. 情节架构（网文套路）===================
plot_architecture_prompt = """\
请你扮演一位经验丰富的小说编辑和剧情架构师。

根据以下提供的小说基础信息、计算出的总卷数和每卷大致章节范围，构思并生成整个故事的【分卷大纲】。

**小说基础信息：**
- 内容指导：{user_guidance}
- 核心种子：{core_seed}
- 角色体系：{character_dynamics}
- 世界观：{world_building}

**分卷大纲生成要求：**

1.  **严格使用 Markdown 格式输出。**
2.  **每一卷的格式必须遵循以下规范：**
    *   以二级标题 `## 第 X 卷：[卷标题]` 作为卷的标题，其中 `X` 是卷的数字序号，`[卷标题]` 是该卷的标题（请为每一卷构思一个合适的标题）。
    *   在卷标题下，使用无序列表 (`- **要素名称：** 内容`) 包含以下要素：
        *   `- **卷序号：** X`
        *   `- **卷标题：** [卷标题]`
        *   `- **预估章节范围：** [起始章节] - [结束章节]` (例如：1 - 200)
        *   `- **本卷核心情节概述：** [对该卷核心剧情、主要冲突和发展方向的简明扼要的总结]`
        *   `- **主要角色发展弧光：** [描述本卷中主要角色（特别是主角）的关键成长、转变、面临的内心挣扎或关系变化]`
        *   `- **本卷结局状态/悬念：** [清晰说明本卷结束时故事的整体状态，关键角色所处的境遇，以及为下一卷留下的悬念或引子]`
    *   在上述要素之后，添加一个三级标题 `### 关键情节里程碑`。
    *   在该三级标题下，使用无序列表 (`- [里程碑描述]`) 清晰地列出该卷中【至少5-8个】关键的情节里程碑事件。每个里程碑应简明扼要地描述一个重要的转折点、冲突的发生与解决、关键信息的揭示、新能力的获得、重要人物的登场或退场，或主角做出的重大决定及其直接后果。

3.  **确保生成的分卷大纲逻辑连贯、层层递进，与提供的小说基础信息（核心种子、角色、世界观）和整体架构（总卷数、章节范围）高度匹配。** 故事发展应符合修仙/奇幻题材的常见成长曲线和世界观拓展规律。
4.  **总共需要生成 {num_volumes} 卷，每卷大约包含 {chapters_per_volume} 章。** 请据此合理分配剧情密度和发展节奏。

请开始生成分卷大纲,禁止任何形式的开场白、解释或附加文本。
"""
# =============== 4. 情节架构（三幕式悬念）===================
plot_architecture2_prompt = """\
基于以下元素：
- 内容指导：{user_guidance}
- 核心种子：{core_seed}
- 角色体系：{character_dynamics}
- 世界观：{world_building}

要求按以下结构设计：
第一幕（触发） 
- 日常状态中的异常征兆（3处铺垫）
- 引出故事：展示主线、暗线、副线的开端
- 关键事件：打破平衡的催化剂（需改变至少3个角色的关系）
- 错误抉择：主角的认知局限导致的错误反应

第二幕（对抗）
- 剧情升级：主线+副线的交叉点
- 双重压力：外部障碍升级+内部挫折
- 虚假胜利：看似解决实则深化危机的转折点
- 灵魂黑夜：世界观认知颠覆时刻

第三幕（解决）
- 代价显现：解决危机必须牺牲的核心价值
- 嵌套转折：至少包含三层认知颠覆（表面解→新危机→终极抉择）
- 余波：留下2个开放式悬念因子

每个阶段需包含3个关键转折点及其对应的伏笔回收方案。
仅给出最终文本，不要解释任何内容。
"""

# =============== 5. 章节目录生成（悬念节奏曲线）===================
chapter_blueprint_prompt = """\
基于以下元素：
- 内容指导：{user_guidance}
- 小说架构：
{novel_architecture}

设计{number_of_chapters}章的节奏分布：
1. 章节集群划分：
- 每3-5章构成一个悬念单元，包含完整的小高潮
- 单元之间设置"认知过山车"（连续2章紧张→1章缓冲）
- 关键转折章需预留多视角铺垫

2. 每章需明确：
- 章节定位（角色/事件/主题等）
- 核心作用（推进/转折/揭示/...）
- 核心悬念类型（信息差/道德困境/时间压力等，请简述悬念点）
- 情感基调迁移（如从怀疑→恐惧→决绝，请简述关键情感表现）
- 伏笔操作（埋设/强化/回收，并关联具体线索或矛盾）
- 认知颠覆强度（1-5级，请简述颠覆的具体信息或事件）

输出格式示例：
第n章 - [标题]
本章定位：[角色/事件/主题/...]
核心作用：[推进/转折/揭示/...]
核心悬念：[类型] - [具体悬念点简述]
情感基调：[初始基调] → [结束基调] (通过[关键角色]的[行为/心理]体现)
伏笔操作：[操作类型]([具体伏笔内容])
认知颠覆：[等级]级 - 因[事件/信息]导致
本章梗概（50-100字）：[详细描述本章发生的【主要事件/冲突】，涉及的【关键角色及其互动】，并体现本章的悬念和情感变化。]

第n+1章 - [标题]
... (同上) ...

要求：
- 使用精炼语言描述。
- 合理安排节奏，确保整体悬念曲线的连贯性。
- 在生成{number_of_chapters}章前不要出现结局章节。

仅给出最终文本，不要解释任何内容。
"""

chunked_chapter_blueprint_prompt = """\
你是一位顶级网络小说编辑和剧情架构师。你的任务是为一部小说的特定章节范围生成详细的、富有节奏感和悬念的章节蓝图。

**一、基本信息与全局设定：**
- 用户内容指导：{user_guidance}
- 小说整体架构与核心设定：
{novel_architecture}
- 卷总章节数：{number_of_chapters}

**二、当前章节所属卷的核心规划 (第 {current_volume_number} 卷：《{current_volume_title}》)：**
- **本卷核心情节概述：** {current_volume_summary}
- **本卷主要角色发展弧光：** {current_volume_character_arcs}
- **本卷结局状态/悬念指引：** {current_volume_ending_cliffhanger}
- **本卷关键情节里程碑：**
{current_volume_milestones_formatted}

**三、上下文参考：已生成的章节蓝图 (若为空则为初始生成)：**
{chapter_list}

**四、本次生成任务：**
请为从第 {n} 章到第 {m} 章设计详细的章节蓝图。

**五、章节蓝图设计指导原则：**

A. **宏观节奏控制 (章节集群与单元)：**
    - 将本次生成的章节视为一个或多个小单元。
    - 如果可能，每3-5章应构成一个包含小高潮的悬念单元，并服务于【当前卷的核心情节】。
    - 尝试在单元之间运用"认知过山车"节奏：例如，若本单元需要紧张，则前序章节可略作缓冲，或本单元高潮后下一章进行缓冲。
    - 如果本次生成的章节范围包含或邻近【本卷关键情节里程碑】中提及的事件，请务必围绕该里程碑进行重点规划，可能需要多视角铺垫或将事件拆分到连续几章。

B. **每章具体要素明确：**
    - **章节定位：** (例如：角色塑造、关键事件发生、世界观揭示、伏笔埋设、日常过渡、战斗高潮等)。**定位需服务于【当前卷的规划目标】和【主要角色发展弧光】。**
    - **核心作用：** (例如：推进主线至XX节点、揭示XX秘密、主角完成XX转变、引出XX新角色/势力、解决XX旧矛盾并引发新矛盾等)。**作用需指向【本卷结局状态/悬念指引】。**
    - **核心悬念：** [类型，如信息差、道德困境、时间压力、未知威胁等] - **具体描述本章制造的悬念点，以及它如何与【本卷核心情节】或【伏笔】关联。**
    - **情感基调：** (例如：紧张、悲伤、喜悦、愤怒、恐惧、希望等)。**描述本章主导的情感氛围，以及关键角色在本章经历的【情感变化】。**
    - **伏笔操作：** [埋设/强化/回收] ([具体伏笔内容])。**伏笔内容应与【小说整体架构】、【当前卷的秘密】或【角色秘密】相关。**
    - **认知颠覆：** [1-5星] - **简述本章哪个信息或事件会给读者带来【认知上的冲击或反转】，可能与【本卷关键情节里程碑】有关。**
    - **本章简述 (3-5句话，约50-100字)：** **清晰概括本章的【核心事件/冲突】、涉及的【主要角色及其关键行动/对话】、以及本章事件如何【推动情节发展】并体现上述定位、作用、悬念和情感。如果本章是某个“关键情节里程碑”的一部分，请明确指出。**

**六、输出格式（严格遵守）：**

第n章 - [章节标题]
本章定位：[...]
核心作用：[...]
核心悬念：[...] - [...]
情感基调：[...] (通过[...]体现)
伏笔操作：[...] ([...])
认知颠覆：[...]星 - [...]
本章简述：[...]

第n+1章 - [章节标题]
(同上格式)
...

**七、其他要求：**
- 使用精炼、富有吸引力的语言。
- 确保章节间的逻辑连贯和节奏起伏，整体服务于【当前卷的规划详情】。
- 【不要】在本次生成的章节内安排当前卷的大结局，除非 {m} 恰好是当前卷的最后一章{number_of_chapters}。
- 【仅输出】从第 {n} 章到第 {m} 章的蓝图文本，不要包含任何解释、开场白或总结。

请开始生成：
"""

# =============== 6. 前文摘要更新 ===================
summary_prompt = """\
以下是新完成的章节文本：
{chapter_text}

这是当前的前文摘要（可为空）：
{global_summary}

请根据本章新增内容，更新前文摘要。
要求：
- 保留既有重要信息，同时融入新剧情要点
- 以简洁、连贯的语言描述全书进展
- 客观描绘，不展开联想或解释
- 总字数控制在2000字以内

仅返回前文摘要文本，不要解释任何内容。
"""

# =============== 7. 角色状态更新 ===================
create_character_state_prompt = """\
依据当前角色动力学设定：{character_dynamics}

请生成一个角色状态文档，内容格式：
例：
张三：
├──物品:
│  ├──青衫：一件破损的青色长袍，带有暗红色的污渍
│  └──寒铁长剑：一柄断裂的铁剑，剑身上刻有古老的符文
├──能力
│  ├──技能1：强大的精神感知能力：能够察觉到周围人的心中活动
│  └──技能2：无形攻击：能够释放一种无法被视觉捕捉的精神攻击
├──状态
│  ├──身体状态: 身材挺拔，穿着华丽的铠甲，面色冷峻
│  └──心理状态: 目前的心态比较平静，但内心隐藏着对柳溪镇未来掌控的野心和不安
├──主要角色间关系网
│  ├──李四：张三从小就与她有关联，对她的成长一直保持关注
│  └──王二：两人之间有着复杂的过去，最近因一场冲突而让对方感到威胁
├──触发或加深的事件
│  ├──村庄内突然出现不明符号：这个不明符号似乎在暗示柳溪镇即将发生重大事件
│  └──李四被刺穿皮肤：这次事件让两人意识到对方的强大实力，促使他们迅速离开队伍

角色名：
├──物品:
│  ├──某物(道具)：描述
│  └──XX长剑(武器)：描述
│   ...
├──能力
│  ├──技能1：描述
│  └──技能2：描述
│   ...
├──状态
│  ├──身体状态：
│  └──心理状态：描述
│    
├──主要角色间关系网
│  ├──李四：描述
│  └──王二：描述
│   ...
├──触发或加深的事件
│  ├──事件1：描述
│  └──事件2：描述
    ...

新出场角色：
- (此处填写未来任何新增角色或临时出场人物的基本信息)

要求：
仅返回编写好的角色状态文本，不要解释任何内容。
"""

update_character_state_prompt = """\
以下是新完成的章节文本：
{chapter_text}

这是当前的角色状态文档：
{old_state}

请更新主要角色状态，内容格式：
例：
张三：
├──物品:
│  ├──青衫：一件破损的青色长袍，带有暗红色的污渍
│  └──寒铁长剑：一柄断裂的铁剑，剑身上刻有古老的符文
├──能力
│  ├──技能1：强大的精神感知能力：能够察觉到周围人的心中活动
│  └──技能2：无形攻击：能够释放一种无法被视觉捕捉的精神攻击
├──状态
│  ├──身体状态: 身材挺拔，穿着华丽的铠甲，面色冷峻
│  └──心理状态: 目前的心态比较平静，但内心隐藏着对柳溪镇未来掌控的野心和不安
├──主要角色间关系网
│  ├──李四：张三从小就与她有关联，对她的成长一直保持关注
│  └──王二：两人之间有着复杂的过去，最近因一场冲突而让对方感到威胁
├──触发或加深的事件
│  ├──村庄内突然出现不明符号：这个不明符号似乎在暗示柳溪镇即将发生重大事件
│  └──李四被刺穿皮肤：这次事件让两人意识到对方的强大实力，促使他们迅速离开队伍

角色名：
├──物品:
│  ├──某物(道具)：描述
│  └──XX长剑(武器)：描述
│   ...
├──能力
│  ├──技能1：描述
│  └──技能2：描述
│   ...
├──状态
│  ├──身体状态：
│  └──心理状态：描述
│    
├──主要角色间关系网
│  ├──李四：描述
│  └──王二：描述
│   ...
├──触发或加深的事件
│  ├──事件1：描述
│  └──事件2：描述
    ...

......

新出场角色：
- 任何新增角色或临时出场人物的基本信息，简要描述即可，不要展开，淡出视线的角色可删除。

要求：
- 请直接在已有文档基础上进行增删
- 不改变原有结构，语言尽量简洁、有条理

仅返回更新后的角色状态文本，不要解释任何内容。
"""

# =============== 8. 章节正文写作 ===================

# 8.1 第一章草稿提示
first_chapter_draft_prompt = """\
即将创作：第 {novel_number} 章《{chapter_title}》
本章定位：{chapter_role}
核心作用：{chapter_purpose}
悬念密度：{suspense_level}
伏笔操作：{foreshadowing}
认知颠覆：{plot_twist_level}
本章简述：{chapter_summary}

可用元素：
- 核心人物(可能未指定)：{characters_involved}
- 关键道具(可能未指定)：{key_items}
- 空间坐标(可能未指定)：{scene_location}
- 时间压力(可能未指定)：{time_constraint}

参考文档：
- 小说设定：
{novel_setting}

完成第 {novel_number} 章的正文，字数要求{word_number}字，至少设计下方2个或以上具有动态张力的场景：
1. 对话场景：
   - 潜台词冲突（表面谈论A，实际博弈B）
   - 权力关系变化（通过非对称对话长度体现）

2. 动作场景：
   - 环境交互细节（至少3个感官描写）
   - 节奏控制（短句加速+比喻减速）
   - 动作揭示人物隐藏特质

3. 心理场景：
   - 认知失调的具体表现（行为矛盾）
   - 隐喻系统的运用（连接世界观符号）
   - 决策前的价值天平描写

4. 环境场景：
   - 空间透视变化（宏观→微观→异常焦点）
   - 非常规感官组合（如"听见阳光的重量"）
   - 动态环境反映心理（环境与人物心理对应）

格式要求：
- 仅返回章节正文文本；
- 不使用分章节小标题；
- 不要使用markdown格式。

额外指导(可能未指定)：{user_guidance}
"""

# 8.2 后续章节草稿提示
next_chapter_draft_prompt = """\
参考文档：
└── 前文摘要：
    {global_summary}

└── 前章结尾段：
    {previous_chapter_excerpt}

└── 用户指导：
    {user_guidance}

└── 角色状态：
    {character_state}

└── 当前章节摘要：
    {short_summary}

当前章节信息：
第{novel_number}章《{chapter_title}》：
├── 章节定位：{chapter_role}
├── 核心作用：{chapter_purpose}
├── 悬念密度：{suspense_level}
├── 伏笔设计：{foreshadowing}
├── 转折程度：{plot_twist_level}
├── 章节简述：{chapter_summary}
├── 字数要求：{word_number}字
├── 核心人物：{characters_involved}
├── 关键道具：{key_items}
├── 场景地点：{scene_location}
└── 时间压力：{time_constraint}

下一章节目录
第{next_chapter_number}章《{next_chapter_title}》：
├── 章节定位：{next_chapter_role}
├── 核心作用：{next_chapter_purpose}
├── 悬念密度：{next_chapter_suspense_level}
├── 伏笔设计：{next_chapter_foreshadowing}
├── 转折程度：{next_chapter_plot_twist_level}
└── 章节简述：{next_chapter_summary}

知识库参考：（按优先级应用）
{filtered_context}

🎯 知识库应用规则：
1. 内容分级：
   - 写作技法类（优先）：
     ▸ 场景构建模板
     ▸ 对话写作技巧
     ▸ 悬念营造手法
   - 设定资料类（选择性）：
     ▸ 独特世界观元素
     ▸ 未使用过的技术细节
   - 禁忌项类（必须规避）：
     ▸ 已在前文出现过的特定情节
     ▸ 重复的人物关系发展

2. 使用限制：
   ● 禁止直接复制已有章节的情节模式
   ● 历史章节内容仅允许：
     → 参照叙事节奏（不超过20%相似度）
     → 延续必要的人物反应模式（需改编30%以上）
   ● 第三方写作知识优先用于：
     → 增强场景表现力（占知识应用的60%以上）
     → 创新悬念设计（至少1处新技巧）

3. 冲突检测：
   ⚠️ 若检测到与历史章节重复：
     - 相似度>40%：必须重构叙事角度
     - 相似度20-40%：替换至少3个关键要素
     - 相似度<20%：允许保留核心概念但改变表现形式

依据前面所有设定，开始完成第 {novel_number} 章的正文，字数要求{word_number}字，
内容生成严格遵循：
-用户指导
-当前章节摘要
-当前章节信息
-无逻辑漏洞,
确保章节内容与前文摘要、前章结尾段衔接流畅、下一章目录保证上下文完整性，

格式要求：
- 仅返回章节正文文本；
- 不使用分章节小标题；
- 不要使用markdown格式。
"""

Character_Import_Prompt = """\
根据以下文本内容，分析出所有角色及其属性信息，严格按照以下格式要求：

<<角色状态格式要求>>
1. 必须包含以下五个分类（按顺序）：
   ● 物品 ● 能力 ● 状态 ● 主要角色间关系网 ● 触发或加深的事件
2. 每个属性条目必须用【名称: 描述】格式
   例：├──青衫: 一件破损的青色长袍，带有暗红色的污渍
3. 状态必须包含：
   ● 身体状态: [当前身体状况]
   ● 心理状态: [当前心理状况]
4. 关系网格式：
   ● [角色名称]: [关系类型，如"竞争对手"/"盟友"]
5. 触发事件格式：
   ● [事件名称]: [简要描述及影响]

<<示例>>
李员外:
├──物品:
│  ├──青衫: 一件破损的青色长袍，带有暗红色污渍
│  └──寒铁长剑: 剑身有裂痕，刻有「青云」符文
├──能力:
│  ├──精神感知: 能感知半径30米内的生命体
│  └──剑气压制: 通过目光释放精神威压
├──状态:
│  ├──身体状态: 右臂有未愈合的刀伤
│  └──心理状态: 对苏明远的实力感到忌惮
├──主要角色间关系网:
│  ├──苏明远: 竞争对手，十年前的同僚
│  └──林婉儿: 暗中培养的继承人
├──触发或加深的事件:
│  ├──兵器库遇袭: 丢失三把传家宝剑，影响战力
│  └──匿名威胁信: 信纸带有檀香味，暗示内部泄密
│

请严格按上述格式分析以下内容：
<<待分析小说文本开始>>
{content}
<<待分析小说文本结束>>
"""
